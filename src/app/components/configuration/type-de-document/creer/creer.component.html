@if(errorTexte !=''){
<div class="alert alert-danger flex items-center" role="alert">
<div>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-alert-circle stroke-danger"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12" y2="16"></line></svg></div>
<span class="txt-light">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{errorTexte}}
</span>
</div>
}
<form class="grid grid-cols-12 gap-6" [formGroup]="formDataTypeDoc" (ngSubmit)="submitForm()">

    <div class="col-span-12">
        <label for="libelle_type_docs" class="form-label text-left block mb-2">
            Libellé <code class="text-red-500">*</code>
        </label>
        <input class="form-control hSoc"
               formControlName="libelle_type_docs"
               id="libelle_type_docs"
               type="text"
               placeholder="Entrez le type de document"
               [ngClass]="{ 'is-invalid' : formDataTypeDoc.controls['libelle_type_docs'].touched &&
                                            formDataTypeDoc.controls['libelle_type_docs'].errors?.['required'] , 'is-valid' : formDataTypeDoc.controls['libelle_type_docs'].valid}"
        >
    </div>

    <div class="col-span-6">
        <label for="dure_prearchive" class="form-label text-left block mb-2">Délais au service (ans)</label>
        <input class="form-control hSoc"
               formControlName="dure_prearchive"
               id="dure_prearchive"
               type="text"
               placeholder="Entrez le libellé de la direction"
               [ngClass]="{ 'is-invalid' : formDataTypeDoc.controls['dure_prearchive'].touched &&
                                            formDataTypeDoc.controls['dure_prearchive'].errors?.['required'] , 'is-valid' : formDataTypeDoc.controls['dure_prearchive'].valid}"
        >
    </div>
    <div class="col-span-6">
        <label for="dure_conservatoire" class="form-label text-left block mb-2">
            Délais de conservation aux archives (ans)</label>
        <input class="form-control hSoc"
               formControlName="dure_conservatoire"
               id="dure_conservatoire"
               type="text"
               placeholder="Entrez le delai de conservation"
               [ngClass]="{ 'is-invalid' : formDataTypeDoc.controls['dure_conservatoire'].touched &&
                                            formDataTypeDoc.controls['dure_conservatoire'].errors?.['required'] , 'is-valid' : formDataTypeDoc.controls['dure_conservatoire'].valid}"
        >
    </div>
    <div class="col-span-6">
        <label class="flex items-center gap-3 cursor-pointer">
            <nz-switch formControlName="etat_type_docs"></nz-switch>
            <span class="form-label mb-0">A detruire après pré-archivage ?</span>
        </label>
    </div>
    <div class="col-span-6">
        <label class="flex items-center gap-3 cursor-pointer">
            <nz-switch formControlName="etat_localite"></nz-switch>
            <span class="form-label mb-0">Souhaitez vous ajouter les départements ?</span>
        </label>
    </div>
    <div class="col-span-6">
        <label class="flex items-center gap-3 cursor-pointer">
            <nz-switch formControlName="etat_personnel"></nz-switch>
            <span class="form-label mb-0">Selectionnez un personnel ?</span>
        </label>
    </div>
    <div class="col-span-6">
        <label class="flex items-center gap-3 cursor-pointer">
            <nz-switch formControlName="etat_engagement"></nz-switch>
            <span class="form-label mb-0">Ajouter les articles ?</span>
        </label>
    </div>


    <div class="col-span-12 relative flex gap-4 mt-4 min-h-[40px]">
        <button (click)="addRow()" class="btn btn-light absolute left-0" type="button">
            <i class="fa-solid fa-plus-circle"></i> Champs additionnels
        </button>
        <button [disabled]="!formDataTypeDoc.valid" class="btn btn-primary text-white absolute right-0" type="submit">
            <i *ngIf="!isLoad" class="fa-solid fa-check-circle"></i>
            <i *ngIf="isLoad" class="fas fa-spin fa-circle-notch"></i>
            {{formDataTypeDoc.value.iddirection ? 'Modifier' : 'Valider'}}
        </button>
    </div>

</form>
<div class="overflow-x-auto w-full">
    <nz-table #basicTable
              [nzSize]="'small'"
              [nzBordered]="true"
              [nzData]="dataLigneFields"
              class="min-w-[700px]">
        <thead>
        <tr>
            <th class="whitespace-nowrap" style="width: 7% !important;">Unique ?</th>
            <th class="whitespace-nowrap">Colonne</th>
            <th class="whitespace-nowrap" style="width: 15% !important;">Type</th>
            <th class="whitespace-nowrap" style="width: 5% !important;">Action</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let data of basicTable.data;let i=index">
            <td class="whitespace-nowrap">
                <nz-switch
                        [(ngModel)]="data.default_proprietes_docs"
                        [disabled]="data.ligneDisabled"
                ></nz-switch>
            </td>
            <td class="whitespace-nowrap">
                <nz-input-group [nzAddOnAfter]="suffixButton">
                    <input class="form-control hSoc"
                           nz-input
                           [(ngModel)]="data.lib_proprietes_docs"
                           [disabled]="data.ligneDisabled"
                           placeholder="Entrez le nom de la colonne" />
                </nz-input-group>

                <ng-template #suffixButton>
                    <button nz-button
                            style=" background: none;border: none;padding: 0px;margin: 0px;"
                            nzType="default"
                            (click)="addSubFields(data.lib_proprietes_docs,i)"
                            [disabled]="data.ligneDisabled">
                        <span nz-icon [nzType]="'plus'"></span>
                    </button>
                </ng-template>

                <nz-table #sousTable
                          [nzData]="data.proprietes_select"
                          [nzSize]="'small'"
                          [nzBordered]="true"

                          *ngIf="data?.proprietes_select?.length">
                        <tbody>
                        <tr *ngFor="let subData of sousTable.data">
                            <td>
                                {{ subData.col1 }}
                                <input class="form-control hSoc"
                                       nz-input
                                       [(ngModel)]="subData.value_proprietes_docs"
                                       placeholder="Entrez le nom de la colonne" />
                            </td>
                        </tr>
                        </tbody>
             </nz-table>
            </td>
            <td class="whitespace-nowrap">
                <nz-select nzShowSearch
                           nzAllowClear
                           nzSize="default"
                           nzPlaceHolder="Selectionnez le type du champ"
                           [(ngModel)]="data.type_proprietes_docs"
                           [disabled]="data.ligneDisabled"
                >
                    <nz-option [nzLabel]="data.label" [nzValue]="data.value" *ngFor="let data of dataFields"></nz-option>
                </nz-select>
            </td>
            <td class="whitespace-nowrap">
                <button nz-button
                        nzType="default"
                        nzShape="circle"
                        nzTooltipTitle="Supprimer {{data.lib_proprietes_docs}}"
                        nzTooltipPlacement="topRight"
                        nz-tooltip
                        nz-popconfirm
                        nzPopconfirmTitle="Êtes vous sûr de bien vouloir supprimer ?"
                        (nzOnConfirm)="deleteRow(data)"
                        nzPopconfirmPlacement="topLeft"
                        [disabled]="data.ligneDisabled"
                >
                    <span nz-icon [nzType]="'delete'"></span>
                </button>
            </td>
        </tr>
        </tbody>
    </nz-table>
</div>